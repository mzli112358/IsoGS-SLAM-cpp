# IsoGS-SLAM C++ 执行命令示例

## 完整项目执行流程

### 前提条件
- 数据集已准备好（例如：Replica数据集）
- 已安装依赖：CUDA、LibTorch、OpenCV、CMake (>=3.20)
- 已下载LibTorch到 `cpp/third_party/libtorch` 目录

### 步骤0: 编译项目

```bash
# 进入cpp目录
cd /media/pw_is_6/Disk2/IsoGS-SLAM/IsoGS-SLAM-cpp/cpp

# 创建build目录
mkdir -p build
cd build

# 配置CMake（Release模式）
cmake .. -DCMAKE_BUILD_TYPE=Release

# 编译（使用多核加速，根据CPU核心数调整-j参数）
make -j8

# 或者使用cmake的build命令
cmake --build . -j8
```

**编译输出**:
- `./isogs_slam` - SLAM主程序
- `./export_ply` - PLY导出工具
- `./post_splatam_opt` - 后优化工具
- `./gaussian_splatting` - 离线训练工具
- `./grad_check` - 梯度检查工具

**注意事项**:
- 如果LibTorch未找到，请确保已下载并解压到 `cpp/third_party/libtorch` 目录
- 对于CUDA 12.1，下载链接：https://download.pytorch.org/libtorch/cu121/libtorch-cxx11-abi-shared-with-deps-2.1.0%2Bcu121.zip
- GPU架构设置为8.9（RTX 4090D），如需修改请编辑 `CMakeLists.txt` 中的 `CMAKE_CUDA_ARCHITECTURES`

---

### 步骤1: 运行SLAM（生成checkpoint）

```bash
cd /media/pw_is_6/Disk2/IsoGS-SLAM/IsoGS-SLAM-cpp/cpp/build

# 基本用法：处理所有帧
./isogs_slam /media/pw_is_6/Disk2/IsoGS-SLAM/IsoGS-SLAM-cpp/data/Replica room0

# 处理前100帧
./isogs_slam /media/pw_is_6/Disk2/IsoGS-SLAM/IsoGS-SLAM-cpp/data/Replica room0 100

# 指定checkpoint保存目录
./isogs_slam /media/pw_is_6/Disk2/IsoGS-SLAM/IsoGS-SLAM-cpp/data/Replica room0 -1 ./my_checkpoints
```

**输出**:
- `./checkpoints/checkpoint_50.npz` (每50帧保存一次)
- `./checkpoints/checkpoint_100.npz`
- `./checkpoints/checkpoint_150.npz`
- ...
- `./checkpoints/final_checkpoint.npz` (最终checkpoint)

---

### 步骤2: 导出点云（PLY格式）

```bash
cd /media/pw_is_6/Disk2/IsoGS-SLAM/IsoGS-SLAM-cpp/cpp/build

# 导出最终checkpoint为PLY
./export_ply ./checkpoints/final_checkpoint.npz ./output/room0_final.ply

# 导出中间checkpoint为PLY
./export_ply ./checkpoints/checkpoint_100.npz ./output/room0_frame100.ply
```

**输出**:
- `./output/room0_final.ply` (点云文件，可用MeshLab/CloudCompare打开)

---

### 步骤3: 后优化（可选）

```bash
cd /media/pw_is_6/Disk2/IsoGS-SLAM/IsoGS-SLAM-cpp/cpp/build

# 对最终checkpoint进行后优化（30000次迭代，默认）
./post_splatam_opt ./checkpoints/final_checkpoint.npz ./output/room0_optimized.npz

# 指定优化迭代次数
./post_splatam_opt ./checkpoints/final_checkpoint.npz ./output/room0_optimized.npz 50000
```

**输出**:
- `./output/room0_optimized.npz` (优化后的checkpoint)

---

### 步骤4: 导出优化后的点云

```bash
cd /media/pw_is_6/Disk2/IsoGS-SLAM/IsoGS-SLAM-cpp/cpp/build

./export_ply ./output/room0_optimized.npz ./output/room0_optimized.ply
```

---

## 完整示例（一条龙执行）

假设数据集路径为 `/media/pw_is_6/Disk2/IsoGS-SLAM/IsoGS-SLAM-cpp/data/Replica`，序列名为 `room0`：

```bash
# 进入build目录
cd /media/pw_is_6/Disk2/IsoGS-SLAM/IsoGS-SLAM-cpp/cpp/build

# 1. 运行SLAM（处理前200帧）
./isogs_slam /media/pw_is_6/Disk2/IsoGS-SLAM/IsoGS-SLAM-cpp/data/Replica room0 200

# 2. 导出最终点云
mkdir -p ./output
./export_ply ./checkpoints/final_checkpoint.npz ./output/room0_final.ply

# 3. 后优化（可选）
./post_splatam_opt ./checkpoints/final_checkpoint.npz ./output/room0_optimized.npz 50000

# 4. 导出优化后的点云
./export_ply ./output/room0_optimized.npz ./output/room0_optimized.ply
```

**最终输出文件**:
- `./checkpoints/final_checkpoint.npz` - 原始SLAM结果
- `./output/room0_final.ply` - 原始点云
- `./output/room0_optimized.npz` - 优化后的模型
- `./output/room0_optimized.ply` - 优化后的点云

---

## 其他工具

### 梯度检查工具

```bash
cd /media/pw_is_6/Disk2/IsoGS-SLAM/IsoGS-SLAM-cpp/cpp/build
./grad_check
```

用于验证梯度计算是否正确，不需要参数。

---

### 离线训练工具（使用数据集工厂）

```bash
cd /media/pw_is_6/Disk2/IsoGS-SLAM/IsoGS-SLAM-cpp/cpp/build

# Replica数据集
./gaussian_splatting replica /media/pw_is_6/Disk2/IsoGS-SLAM/IsoGS-SLAM-cpp/data/Replica room0 ./output/training

# TUM数据集
./gaussian_splatting tum /media/pw_is_6/Disk2/IsoGS-SLAM/IsoGS-SLAM-cpp/data/TUM rgbd_dataset_freiburg1_xyz ./output/training
```

---

## 注意事项

1. **路径**: 使用绝对路径或相对于build目录的路径
2. **数据集格式**: 确保数据集格式正确（参考数据集格式要求）
3. **GPU内存**: 建议至少16GB GPU内存
4. **checkpoint目录**: 会自动创建，无需手动创建

---

## 快速测试（小数据集）

如果只想快速测试，处理少量帧：

```bash
cd /media/pw_is_6/Disk2/IsoGS-SLAM/IsoGS-SLAM-cpp/cpp/build

# 只处理前10帧
./isogs_slam /media/pw_is_6/Disk2/IsoGS-SLAM/IsoGS-SLAM-cpp/data/Replica room0 10

# 导出点云
./export_ply ./checkpoints/final_checkpoint.npz ./output/test.ply
```

