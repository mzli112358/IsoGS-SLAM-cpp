# é¡¹ç›®æ¡†æ¶ç»“æ„

**æ›´æ–°æ—¶é—´**: 2024-12

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜C++é‡æ„é¡¹ç›®çš„æ•´ä½“æ¶æ„ã€æ¨¡å—åˆ’åˆ†å’Œæ•°æ®æµï¼Œä»¥åŠä¸åŸå§‹Pythoné¡¹ç›®çš„å¯¹åº”å…³ç³»ã€‚

---

## ä¸€ã€é¡¹ç›®ç›®å½•ç»“æ„

```
cpp/
â”œâ”€â”€ CMakeLists.txt              # ä¸»CMakeé…ç½®
â”œâ”€â”€ main.cpp                    # ä¸»ç¨‹åºå…¥å£ï¼ˆæµ‹è¯•/æ¼”ç¤ºï¼‰
â”œâ”€â”€ include/                    # å¤´æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ core/                   # æ ¸å¿ƒæ•°æ®ç»“æ„
â”‚   â”‚   â”œâ”€â”€ gaussian_model.hpp  # é«˜æ–¯æ¨¡å‹å†…å­˜æ± 
â”‚   â”‚   â”œâ”€â”€ camera.hpp          # ç›¸æœºå‚æ•°ç®¡ç†
â”‚   â”‚   â””â”€â”€ types.hpp           # åŸºç¡€ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ slam/                   # SLAMæ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ slam_loop.hpp       # SLAMä¸»å¾ªç¯
â”‚   â”‚   â”œâ”€â”€ tracker.hpp         # Trackingæ¨¡å—
â”‚   â”‚   â””â”€â”€ mapper.hpp          # Mappingæ¨¡å—
â”‚   â”œâ”€â”€ losses/                  # Lossè®¡ç®—æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ flat_loss.hpp      # Flat Loss
â”‚   â”‚   â””â”€â”€ iso_loss.hpp       # Iso-Surface Loss
â”‚   â”œâ”€â”€ rendering/             # æ¸²æŸ“æ¨¡å—
â”‚   â”‚   â””â”€â”€ renderer.hpp        # æ¸²æŸ“å™¨ï¼ˆgsplaté›†æˆï¼‰
â”‚   â”œâ”€â”€ meshing/               # ç½‘æ ¼æå–æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ marching_cubes.hpp # Marching Cubes
â”‚   â”‚   â””â”€â”€ mesh_extractor.hpp  # ç½‘æ ¼æå–å™¨
â”‚   â”œâ”€â”€ datasets/              # æ•°æ®é›†åŠ è½½å™¨
â”‚   â”‚   â”œâ”€â”€ dataset_base.hpp   # æ•°æ®é›†åŸºç±»
â”‚   â”‚   â”œâ”€â”€ replica_dataset.hpp # Replicaæ•°æ®é›†
â”‚   â”‚   â”œâ”€â”€ tum_dataset.hpp     # TUMæ•°æ®é›† âœ… æ–°å¢
â”‚   â”‚   â”œâ”€â”€ scannet_dataset.hpp # ScanNetæ•°æ®é›† âœ… æ–°å¢
â”‚   â”‚   â”œâ”€â”€ scannetpp_dataset.hpp # ScanNet++æ•°æ®é›† âœ… æ–°å¢
â”‚   â”‚   â”œâ”€â”€ replica_v2_dataset.hpp # ReplicaV2æ•°æ®é›† âœ… æ–°å¢
â”‚   â”‚   â””â”€â”€ dataset_factory.hpp  # æ•°æ®é›†å·¥å‚ âœ… æ–°å¢
â”‚   â””â”€â”€ utils/                 # å·¥å…·æ¨¡å—
â”‚       â”œâ”€â”€ optimizer.hpp       # CUDA Adamä¼˜åŒ–å™¨
â”‚       â”œâ”€â”€ spatial_hash.hpp   # ç©ºé—´å“ˆå¸Œè¡¨
â”‚       â”œâ”€â”€ pointcloud.hpp     # ç‚¹äº‘å·¥å…·
â”‚       â”œâ”€â”€ io.hpp              # Checkpoint I/O
â”‚       â”œâ”€â”€ eval.hpp            # è¯„ä¼°å·¥å…·
â”‚       â”œâ”€â”€ losses.hpp          # é€šç”¨Losså‡½æ•°
â”‚       â”œâ”€â”€ keyframe_selection.hpp  # å…³é”®å¸§é€‰æ‹©ç®—æ³• âœ… æ–°å¢
â”‚       â”œâ”€â”€ trajectory_eval.hpp     # è½¨è¿¹è¯„ä¼° âœ… æ–°å¢
â”‚       â”œâ”€â”€ nvs_eval.hpp            # æ–°è§†è§’åˆæˆè¯„ä¼° âœ… æ–°å¢
â”‚       â”œâ”€â”€ mesh_eval.hpp           # ç½‘æ ¼å‡ ä½•è¯„ä¼° âœ… æ–°å¢
â”‚       â””â”€â”€ common_utils.hpp        # é€šç”¨å·¥å…·å‡½æ•° âœ… æ–°å¢
â”œâ”€â”€ src/                       # C++æºæ–‡ä»¶ï¼ˆä¸includeç›®å½•ç»“æ„å¯¹åº”ï¼‰
â”‚   â””â”€â”€ tools/                 # å·¥å…·å¯æ‰§è¡Œç¨‹åº âœ… æ–°å¢
â”‚       â”œâ”€â”€ export_ply.cpp     # å¯¼å‡ºPLYç‚¹äº‘
â”‚       â”œâ”€â”€ gaussian_splatting.cpp # ç¦»çº¿è®­ç»ƒ
â”‚       â””â”€â”€ post_splatam_opt.cpp   # SLAMåä¼˜åŒ–
â”œâ”€â”€ cuda/                      # CUDAä»£ç 
â”‚   â”œâ”€â”€ kernels/               # CUDA Kernel
â”‚   â”‚   â”œâ”€â”€ flat_loss.cu       # Flat Loss Kernel
â”‚   â”‚   â”œâ”€â”€ iso_loss.cu        # Iso Loss Kernel
â”‚   â”‚   â”œâ”€â”€ optimizer.cu       # Adamä¼˜åŒ–å™¨Kernel
â”‚   â”‚   â”œâ”€â”€ spatial_hash.cu    # ç©ºé—´å“ˆå¸ŒKernel
â”‚   â”‚   â”œâ”€â”€ densify.cu         # Densification Kernel
â”‚   â”‚   â””â”€â”€ prune.cu           # Pruning Kernel
â”‚   â””â”€â”€ device_utils.cuh        # CUDAå·¥å…·å®
â”œâ”€â”€ third_party/               # ç¬¬ä¸‰æ–¹åº“
â”‚   â”œâ”€â”€ libtorch/              # LibTorch
â”‚   â”œâ”€â”€ gsplat/                # gsplatæ¸²æŸ“åº“
â”‚   â””â”€â”€ cnpy/                  # cnpyåº“ï¼ˆ.npzæ–‡ä»¶æ”¯æŒï¼‰
â”œâ”€â”€ python_bindings/           # Pythonç»‘å®š âœ… æ–°å¢
â”‚   â””â”€â”€ viz_bindings.cpp       # å¯è§†åŒ–Pythonç»‘å®š
â”œâ”€â”€ viz/                       # å¯è§†åŒ–æ¨¡å— âœ… æ–°å¢
â”‚   â”œâ”€â”€ visualizer.hpp/cpp     # åŸºç¡€å¯è§†åŒ–æ¥å£
â”‚   â”œâ”€â”€ online_viz.hpp/cpp     # åœ¨çº¿å¯è§†åŒ–
â”‚   â””â”€â”€ final_viz.hpp/cpp      # æœ€ç»ˆé‡å»ºå¯è§†åŒ–
â””â”€â”€ tests/                     # æµ‹è¯•ä»£ç 
    â””â”€â”€ grad_check.cpp         # æ¢¯åº¦æ£€æŸ¥å·¥å…·
```

---

## äºŒã€æ ¸å¿ƒæ¨¡å—æ¶æ„

### 2.1 æ•°æ®æµå›¾

```
æ•°æ®é›†åŠ è½½å™¨ (Dataset)
    â†“
SLAMä¸»å¾ªç¯ (SLAMLoop)
    â”œâ”€â”€â†’ ç¬¬ä¸€å¸§åˆå§‹åŒ–
    â”‚       â””â”€â”€â†’ ç‚¹äº‘æå– (PointCloudUtils)
    â”‚       â””â”€â”€â†’ é«˜æ–¯æ¨¡å‹åˆå§‹åŒ– (GaussianModel)
    â”‚
    â”œâ”€â”€â†’ Trackingå¾ªç¯
    â”‚       â”œâ”€â”€â†’ æ¸²æŸ“å™¨ (Renderer) â†’ RGB/Depthæ¸²æŸ“
    â”‚       â”œâ”€â”€â†’ Lossè®¡ç®— (RGB + Depth + SSIM)
    â”‚       â””â”€â”€â†’ ä½å§¿ä¼˜åŒ– (Tracker)
    â”‚
    â””â”€â”€â†’ Mappingå¾ªç¯
            â”œâ”€â”€â†’ æ¸²æŸ“å™¨ (Renderer) â†’ RGB/Depthæ¸²æŸ“
            â”œâ”€â”€â†’ Lossè®¡ç®— (RGB + Depth + Flat + Iso)
            â”œâ”€â”€â†’ ä¼˜åŒ–å™¨æ›´æ–° (CudaAdamOptimizer)
            â”œâ”€â”€â†’ Densification (GaussianModel)
            â””â”€â”€â†’ Pruning (GaussianModel)
```

### 2.2 æ¨¡å—ä¾èµ–å…³ç³»

```
SLAMLoop
    â”œâ”€â”€â†’ Dataset (æ•°æ®é›†)
    â”œâ”€â”€â†’ GaussianModel (é«˜æ–¯æ¨¡å‹)
    â”œâ”€â”€â†’ Tracker (Tracking)
    â””â”€â”€â†’ Mapper (Mapping)

Tracker
    â”œâ”€â”€â†’ Renderer (æ¸²æŸ“)
    â””â”€â”€â†’ Lossè®¡ç®— (RGB + Depth + SSIM)

Mapper
    â”œâ”€â”€â†’ Renderer (æ¸²æŸ“)
    â”œâ”€â”€â†’ FlatLoss (å‡ ä½•çº¦æŸ)
    â”œâ”€â”€â†’ IsoSurfaceLoss (å‡ ä½•çº¦æŸ)
    â”œâ”€â”€â†’ SpatialHash (ç©ºé—´åŠ é€Ÿ)
    â”œâ”€â”€â†’ CudaAdamOptimizer (å‚æ•°ä¼˜åŒ–)
    â””â”€â”€â†’ GaussianModel (Densification/Pruning)

Renderer
    â””â”€â”€â†’ gsplatåº“ (CUDAæ¸²æŸ“)

FlatLoss / IsoSurfaceLoss
    â””â”€â”€â†’ CUDA Kernel (GPUè®¡ç®—)
```

---

## ä¸‰ã€æ ¸å¿ƒæ•°æ®ç»“æ„

### 3.1 GaussianModelï¼ˆé«˜æ–¯æ¨¡å‹å†…å­˜æ± ï¼‰

```cpp
class GaussianModel {
    // é¢„åˆ†é…çš„æ˜¾å­˜ï¼ˆæ”¯æŒ2000ä¸‡é«˜æ–¯ï¼‰
    Tensor means3D_;        // [N_MAX, 3] - é«˜æ–¯ä¸­å¿ƒä½ç½®
    Tensor scales_;         // [N_MAX, 3] - å°ºåº¦ï¼ˆlogç©ºé—´ï¼‰
    Tensor rotations_;      // [N_MAX, 4] - æ—‹è½¬ï¼ˆå››å…ƒæ•°ï¼‰
    Tensor sh_coeffs_;      // [N_MAX, 48] - SHç³»æ•°
    Tensor opacity_;        // [N_MAX, 1] - ä¸é€æ˜åº¦ï¼ˆlogitç©ºé—´ï¼‰
    Tensor alive_mask_;     // [N_MAX] - æ´»è·ƒæ©ç 
    
    int64_t active_count_;  // å½“å‰æ´»è·ƒé«˜æ–¯æ•°é‡
    int64_t max_gaussians_; // æœ€å¤§å®¹é‡
};
```

**å…³é”®ç‰¹æ€§**:
- é¢„åˆ†é…æ˜¾å­˜ï¼Œé¿å…é¢‘ç¹åˆ†é…
- ä½¿ç”¨ä½æ©ç ç®¡ç†æ´»è·ƒé«˜æ–¯
- æ”¯æŒé›¶æ‹·è´çš„densificationå’Œpruning

### 3.2 Cameraï¼ˆç›¸æœºå‚æ•°ï¼‰

```cpp
class Camera {
    Tensor intrinsics_;    // [3, 3] - ç›¸æœºå†…å‚
    Tensor w2c_;           // [4, 4] - ä¸–ç•Œåˆ°ç›¸æœºå˜æ¢çŸ©é˜µ
    Tensor c2w_;          // [4, 4] - ç›¸æœºåˆ°ä¸–ç•Œå˜æ¢çŸ©é˜µ
    int width_, height_;   // å›¾åƒå°ºå¯¸
};
```

### 3.3 Keyframeï¼ˆå…³é”®å¸§ï¼‰

```cpp
struct Keyframe {
    int frame_id;
    Camera camera;
    Tensor color;          // [3, H, W]
    Tensor depth;          // [H, W]
};
```

---

## å››ã€SLAMä¸»å¾ªç¯æµç¨‹

### 4.1 åˆå§‹åŒ–é˜¶æ®µ

```
1. åŠ è½½ç¬¬ä¸€å¸§RGB-Dæ•°æ®
2. æå–ç‚¹äº‘ (PointCloudUtils::extractPointCloud)
3. åˆå§‹åŒ–é«˜æ–¯æ¨¡å‹ (GaussianModel::initializeFromPointCloud)
4. è®¾ç½®åˆå§‹ç›¸æœºä½å§¿
```

### 4.2 Trackingé˜¶æ®µï¼ˆæ¯å¸§ï¼‰

```
1. åŠ è½½å½“å‰å¸§RGB-Dæ•°æ®
2. åˆå§‹åŒ–ç›¸æœºä½å§¿ï¼ˆä½¿ç”¨ä¸Šä¸€å¸§æˆ–GTï¼‰
3. æ¸²æŸ“å½“å‰è§†å›¾ (Renderer::renderRGBD)
4. è®¡ç®—Loss (RGB + Depth + SSIM)
5. ä¼˜åŒ–ä½å§¿ (Tracker::optimizePose)
   - ä½¿ç”¨LibTorch Adamä¼˜åŒ–å™¨
   - å¯å¾®æ¸²æŸ“æ”¯æŒæ¢¯åº¦
6. æ›´æ–°ç›¸æœºä½å§¿
```

### 4.3 Mappingé˜¶æ®µï¼ˆæ¯Nå¸§ï¼‰

```
1. æ·»åŠ å…³é”®å¸§ (Mapper::addKeyframe)
2. ä¼˜åŒ–å¾ªç¯ (Mapper::optimize)
   For each iteration:
     a. éšæœºé€‰æ‹©å…³é”®å¸§
     b. æ¸²æŸ“è§†å›¾ (Renderer::renderRGBD)
     c. è®¡ç®—Losså’Œæ¢¯åº¦:
        - RGB Loss (L1) - ä½¿ç”¨LibTorch Autograd
        - Depth Loss (L1) - ä½¿ç”¨LibTorch Autograd
        - Flat Loss (å‡ ä½•çº¦æŸ) - âœ… æ‰‹åŠ¨æ¢¯åº¦è®¡ç®—
        - Iso-Surface Loss (å‡ ä½•çº¦æŸ) - âœ… æ‰‹åŠ¨æ¢¯åº¦è®¡ç®—
     d. å°†æ¢¯åº¦å†™å…¥ä¼˜åŒ–å™¨
     e. æ›´æ–°å‚æ•° (CudaAdamOptimizer::step) âœ… å·²é›†æˆ
     f. å°†æ›´æ–°åçš„å‚æ•°å†™å›model
     g. æ¸…é›¶æ¢¯åº¦
3. Densification (æ¯100æ¬¡è¿­ä»£) âœ… å·²å®ç°
   - æ£€æµ‹éœ€è¦åˆ†è£‚/å…‹éš†çš„é«˜æ–¯ï¼ˆåŸºäºæ¢¯åº¦é˜ˆå€¼ï¼‰
   - æ‰§è¡Œåˆ†è£‚/å…‹éš†æ“ä½œ
   - æ›´æ–°æ´»è·ƒæ©ç 
4. Pruning (æ¯100æ¬¡è¿­ä»£) âœ… å·²å®ç°
   - æ£€æµ‹éœ€è¦åˆ é™¤çš„é«˜æ–¯ï¼ˆåŸºäºopacityå’Œscaleï¼‰
   - æ‰§è¡Œåˆ é™¤æ“ä½œ
   - å‹ç¼©å’Œé‡æ–°æ’åˆ—æ•°æ®
```

---

## äº”ã€Lossè®¡ç®—æµç¨‹

### 5.1 Flat Loss

```
è¾“å…¥: scales [N, 3] (å®é™…ç©ºé—´ï¼Œélogç©ºé—´)
æµç¨‹:
  1. å¯¹æ¯ä¸ªé«˜æ–¯ï¼Œæ‰¾åˆ°æœ€å°è½´: s_min = min(s_x, s_y, s_z)
  2. Loss = mean(s_min)
  3. æ¢¯åº¦: åªæœ‰æœ€å°è½´æœ‰æ¢¯åº¦ = 1/N
å®ç°: CUDA Kernel (flat_loss.cu)
```

### 5.2 Iso-Surface Loss

```
è¾“å…¥: 
  - means [N, 3] - é«˜æ–¯ä¸­å¿ƒ
  - inv_covariances [N, 3, 3] - é€†åæ–¹å·®çŸ©é˜µ
  - opacities [N, 1] - ä¸é€æ˜åº¦
  - query_points [M, 3] - æŸ¥è¯¢ç‚¹ï¼ˆé‡‡æ ·ç‚¹ï¼‰
  - spatial_hash - ç©ºé—´å“ˆå¸Œè¡¨ï¼ˆåŠ é€ŸKNNï¼‰âœ… å·²å®ç°

æµç¨‹:
  1. å¯¹æ¯ä¸ªæŸ¥è¯¢ç‚¹ï¼Œä½¿ç”¨ç©ºé—´å“ˆå¸ŒæŸ¥è¯¢Kä¸ªæœ€è¿‘é‚»é«˜æ–¯ âœ… å·²å®ç°
  2. è®¡ç®—å¯†åº¦: D(p) = sum(alpha_j * exp(-0.5 * delta^T * inv_cov_j * delta))
  3. Loss = mean((D(p) - target_saturation)^2)
  4. è®¡ç®—æ¢¯åº¦ï¼ˆå®Œæ•´ç‰ˆæœ¬ï¼‰:
     - w.r.t. means: dL/dmu = loss_grad * alpha * exp_term * inv_cov * delta
     - w.r.t. opacity: dL/dalpha = loss_grad * exp_term
  5. ä»…è®¡ç®—Lossç‰ˆæœ¬ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰âœ… å·²å®ç°

å®ç°: CUDA Kernel (iso_loss.cu) - å®Œæ•´ç‰ˆæœ¬å’Œä»…Lossç‰ˆæœ¬
```

---

## å…­ã€æ¸²æŸ“æµç¨‹

### 6.1 RGBæ¸²æŸ“

```
1. è·å–é«˜æ–¯å‚æ•°ï¼ˆåªå–æ´»è·ƒéƒ¨åˆ†ï¼‰
2. æŠ•å½±åˆ°2D (gsplat::projection_ewa_3dgs_fused_fwd)
   - è®¡ç®—means2d, conics, radii, depths
3. è®¡ç®—SHé¢œè‰² (gsplat::spherical_harmonics_fwd)
4. Tile intersection (gsplat::intersect_tile)
5. å…‰æ …åŒ– (gsplat::rasterize_to_pixels_3dgs_fwd)
6. è¾“å‡º: [3, H, W] RGBå›¾åƒ
```

### 6.2 Depthæ¸²æŸ“

```
1. è·å–é«˜æ–¯å‚æ•°
2. æŠ•å½±åˆ°2Dï¼ˆè·å–depthsï¼‰
3. ä½¿ç”¨depthsä½œä¸ºé¢œè‰²é€šé“
4. Tile intersection
5. å…‰æ …åŒ–
6. è¾“å‡º: [H, W] æ·±åº¦å›¾
```

---

## ä¸ƒã€ä¼˜åŒ–å™¨æ¶æ„

### 7.1 CudaAdamOptimizer

```
å‚æ•°ç»„ç®¡ç†:
  - æ¯ä¸ªå‚æ•°ç»„æœ‰ç‹¬ç«‹çš„å­¦ä¹ ç‡
  - ç»´æŠ¤momentum (m) å’Œ variance (v)
  
æ›´æ–°æµç¨‹:
  1. æ”¶é›†æ¢¯åº¦
  2. è°ƒç”¨CUDA Kernelæ›´æ–°å‚æ•°
  3. æ¸…é›¶æ¢¯åº¦

CUDA Kernel (optimizer.cu):
  - å®ç°Adamæ›´æ–°å…¬å¼
  - æ”¯æŒä¸åŒå‚æ•°ç»„
```

---

## å…«ã€ç©ºé—´å“ˆå¸Œæ¶æ„

### 8.1 æ„å»ºæµç¨‹

```
1. è®¡ç®—è¾¹ç•Œæ¡† (min/max of means)
2. è®¡ç®—æ ¼å­æ•°é‡ (åŸºäºcell_size)
3. ä¸ºæ¯ä¸ªé«˜æ–¯è®¡ç®—cellç´¢å¼•ï¼ˆCUDA Kernelï¼‰
4. ä½¿ç”¨LibTorchæ’åºå’Œè®¡æ•° âœ… å·²å®ç°
5. å¡«å……cell_offsetså’Œcell_contents âœ… å·²å®ç°
6. ä¿å­˜meansç”¨äºKNNæŸ¥è¯¢ âœ… å·²å®ç°
```

### 8.2 KNNæŸ¥è¯¢æµç¨‹

```
1. è®¡ç®—æŸ¥è¯¢ç‚¹çš„cellç´¢å¼•
2. æŸ¥è¯¢è¯¥cellåŠ26ä¸ªé‚»åŸŸcellï¼ˆCUDA Kernelï¼‰âœ… å·²å®ç°
3. è®¡ç®—è·ç¦»å¹¶æ’åºï¼ˆåœ¨Kernelä¸­å®Œæˆï¼‰
4. è¿”å›Kä¸ªæœ€è¿‘é‚»ç´¢å¼• âœ… å·²å®ç°
```

---

## ä¹ã€ä¸Pythonç‰ˆæœ¬çš„å¯¹åº”å…³ç³»

### 9.1 æ ¸å¿ƒæ¨¡å—å¯¹åº”

| Pythonæ¨¡å— | C++æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
|-----------|---------|------|------|
| `splatam.py::rgbd_slam` | `SLAMLoop` | âœ… æ¡†æ¶å®Œæ•´ | ä¸»å¾ªç¯é€»è¾‘å·²å®ç° |
| `splatam.py::tracking` | `Tracker` | âœ… å®Œæ•´å®ç° | RGB/Depth/SSIM Losså·²å®ç° |
| `splatam.py::mapping` | `Mapper` | âœ… å®Œæ•´å®ç° | ä¼˜åŒ–å™¨å·²é›†æˆï¼ŒDensification/Pruningå·²å®ç° |
| `compute_flat_loss` | `FlatLoss` | âœ… å®Œæ•´å®ç° | CUDA Kernelå®ç° |
| `compute_iso_loss` | `IsoSurfaceLoss` | âœ… æ ¸å¿ƒåŠŸèƒ½å®Œæ•´ | ç©ºé—´å“ˆå¸ŒåŠ é€Ÿå·²å®ç° |
| `diff_gaussian_rasterization` | `Renderer` (gsplat) | âœ… å®Œæ•´å®ç° | ä½¿ç”¨gsplatåº“ |
| Checkpointä¿å­˜/åŠ è½½ | `CheckpointIO` | âœ… å®Œæ•´å®ç° | å·²é›†æˆåˆ°SLAMå¾ªç¯ |
| `get_pointcloud` | `PointCloudUtils` | âœ… å®Œæ•´å®ç° | ç‚¹äº‘æå–åŠŸèƒ½ |
| `densify` | `GaussianModel::densify` | âœ… å®Œæ•´å®ç° | CUDA Kernelå®ç° |
| `prune_gaussians` | `GaussianModel::prune` | âœ… å®Œæ•´å®ç° | è‡ªåŠ¨æ¸…ç†åŠŸèƒ½ |
| `keyframe_selection_overlap` | `KeyframeSelection` | âœ… å®Œæ•´å®ç° | å…³é”®å¸§é€‰æ‹©ç®—æ³• |
| `eval` / `eval_nvs` | `NVSEvaluator` | ğŸŸ¡ æ¡†æ¶å®ç° | PSNR/SSIMå·²å®ç°ï¼Œæ¡†æ¶å·²å°±ç»ª |
| `extract_mesh_fast.py` | `MeshExtractor` | âœ… å®Œæ•´å®ç° | Marching Cubes + ç½‘æ ¼æå– |

### 9.2 å·¥å…·æ¨¡å—å¯¹åº”

| Pythonæ¨¡å— | C++æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
|-----------|---------|------|------|
| `utils/common_utils.py` | âŒ æœªå®ç° | ğŸ”´ ç¼ºå¤± | ç§å­è®¾ç½®ã€å‚æ•°è½¬æ¢ç­‰ |
| `utils/eval_helpers.py` | `EvalUtils` | ğŸŸ¡ éƒ¨åˆ†å®ç° | ç¼ºå°‘è½¨è¿¹è¯„ä¼°ã€æ–°è§†è§’åˆæˆè¯„ä¼° |
| `utils/slam_helpers.py` | éƒ¨åˆ†åœ¨`Renderer`/`Tracker` | ğŸŸ¡ éƒ¨åˆ†å®ç° | å‚æ•°è½¬æ¢ã€ä½å§¿å˜æ¢ç­‰ |
| `utils/slam_external.py` | éƒ¨åˆ†åœ¨`Losses`/`Optimizer` | ğŸŸ¡ éƒ¨åˆ†å®ç° | SSIMã€Densifyã€Pruneå·²å®ç° |
| `utils/keyframe_selection.py` | âŒ æœªå®ç° | ğŸ”´ ç¼ºå¤± | å…³é”®å¸§é€‰æ‹©ç®—æ³• |
| `utils/recon_helpers.py::setup_camera` | `Camera` | âœ… å®Œæ•´å®ç° | ç›¸æœºè®¾ç½® |
| `utils/neighbor_search.py` | `SpatialHash` | âœ… å®Œæ•´å®ç° | ç©ºé—´å“ˆå¸Œæ›¿ä»£KNN |

### 9.3 è„šæœ¬å¯¹åº”

| Pythonè„šæœ¬ | C++å¯¹åº” | çŠ¶æ€ | è¯´æ˜ |
|-----------|---------|------|------|
| `scripts/splatam.py` | `main.cpp` + `SLAMLoop` | âœ… æ ¸å¿ƒåŠŸèƒ½å®Œæ•´ | SLAMä¸»å¾ªç¯ |
| `scripts/export_ply.py` | `export_ply` (å¯æ‰§è¡Œç¨‹åº) | âœ… å®Œæ•´å®ç° | å¯¼å‡ºé«˜æ–¯ç‚¹äº‘ä¸ºPLY |
| `scripts/gaussian_splatting.py` | `gaussian_splatting` (å¯æ‰§è¡Œç¨‹åº) | ğŸŸ¡ æ¡†æ¶å®ç° | ç¦»çº¿é«˜æ–¯æ³¼æº…è®­ç»ƒ |
| `scripts/post_splatam_opt.py` | `post_splatam_opt` (å¯æ‰§è¡Œç¨‹åº) | ğŸŸ¡ æ¡†æ¶å®ç° | SLAMåä¼˜åŒ– |
| `scripts/eval_novel_view.py` | `NVSEvaluator` | ğŸŸ¡ æ¡†æ¶å®ç° | æ–°è§†è§’åˆæˆè¯„ä¼° |
| `scripts/extract_mesh_fast.py` | `MeshExtractor` | âœ… å®Œæ•´å®ç° | ç½‘æ ¼æå– |
| `scripts/eval_mesh_geometry.py` | `MeshEvaluator` | ğŸŸ¡ æ ¸å¿ƒåŠŸèƒ½å®ç° | ç½‘æ ¼å‡ ä½•è¯„ä¼°ï¼ˆChamfer Distanceã€F-scoreå·²å®ç°ï¼‰ |
| `scripts/iphone_demo.py` | âŒ æœªå®ç° | ğŸ”´ ç¼ºå¤± | iPhoneåœ¨çº¿æ¼”ç¤º |
| `scripts/nerfcapture2dataset.py` | âŒ æœªå®ç° | ğŸ”´ ç¼ºå¤± | NeRFCaptureæ•°æ®é›†è½¬æ¢ |
| `viz_scripts/online_recon.py` | `OnlineVisualizer` + PythonåŒ…è£…å™¨ | ğŸŸ¡ æ¡†æ¶å®ç° | åœ¨çº¿å¯è§†åŒ– |
| `viz_scripts/final_recon.py` | `FinalVisualizer` + PythonåŒ…è£…å™¨ | ğŸŸ¡ æ¡†æ¶å®ç° | æœ€ç»ˆé‡å»ºå¯è§†åŒ– |

### 9.4 æ•°æ®é›†æ”¯æŒå¯¹åº”

| Pythonæ•°æ®é›† | C++æ•°æ®é›† | çŠ¶æ€ | è¯´æ˜ |
|-------------|----------|------|------|
| `ReplicaDataset` | `ReplicaDataset` | âœ… å®Œæ•´å®ç° | Replicaæ•°æ®é›† |
| `TUMDataset` | `TUMDataset` | ğŸŸ¡ æ¡†æ¶å®ç° | TUM RGB-Dæ•°æ®é›† |
| `ScannetDataset` | `ScanNetDataset` | ğŸŸ¡ æ¡†æ¶å®ç° | ScanNetæ•°æ®é›† |
| `ScannetPPDataset` | `ScanNetPPDataset` | ğŸŸ¡ æ¡†æ¶å®ç° | ScanNet++æ•°æ®é›† |
| `ReplicaV2Dataset` | `ReplicaV2Dataset` | ğŸŸ¡ æ¡†æ¶å®ç° | Replica-V2æ•°æ®é›† |
| `NeRFCaptureDataset` | âŒ æœªå®ç° | ğŸ”´ ç¼ºå¤± | iPhone/NeRFCaptureæ•°æ®é›† |
| `ICLDataset` | âŒ æœªå®ç° | ğŸ”´ ç¼ºå¤± | ICLæ•°æ®é›† |
| `AzureKinectDataset` | âŒ æœªå®ç° | ğŸ”´ ç¼ºå¤± | Azure Kinectæ•°æ®é›† |
| `Record3DDataset` | âŒ æœªå®ç° | ğŸ”´ ç¼ºå¤± | Record3Dæ•°æ®é›† |
| `RealsenseDataset` | âŒ æœªå®ç° | ğŸ”´ ç¼ºå¤± | RealSenseæ•°æ®é›† |
| `Ai2thorDataset` | âŒ æœªå®ç° | ğŸ”´ ç¼ºå¤± | AI2Thoræ•°æ®é›† |

---

## åã€å…³é”®è®¾è®¡å†³ç­–

### 10.1 æ˜¾å­˜ç®¡ç†
- **é¢„åˆ†é…ç­–ç•¥**: é¿å…é¢‘ç¹åˆ†é…é‡Šæ”¾ï¼Œå‡å°‘æ˜¾å­˜ç¢ç‰‡
- **ä½æ©ç ç®¡ç†**: é«˜æ•ˆç®¡ç†æ´»è·ƒé«˜æ–¯
- **é›¶æ‹·è´æ“ä½œ**: Densificationå’ŒPruningä¸åˆ†é…æ–°æ˜¾å­˜

### 10.2 æ¢¯åº¦è®¡ç®—
- **æ‰‹åŠ¨æ¢¯åº¦**: Flat Losså’ŒIso Lossä½¿ç”¨æ‰‹åŠ¨æ¨å¯¼çš„æ¢¯åº¦ï¼Œé¿å…Autogradå¼€é”€
- **å¯å¾®æ¸²æŸ“**: Trackerä½¿ç”¨LibTorch Autogradè¿›è¡Œä½å§¿ä¼˜åŒ–
- **æ··åˆç­–ç•¥**: ç›¸æœºä½å§¿ç”¨Autogradï¼Œé«˜æ–¯å‚æ•°ç”¨æ‰‹åŠ¨æ¢¯åº¦

### 10.3 æ€§èƒ½ä¼˜åŒ–
- **ç©ºé—´å“ˆå¸ŒåŠ é€Ÿ**: Iso Lossçš„KNNæŸ¥è¯¢ä»O(NÂ·M)é™è‡³O(KÂ·M)
- **CUDA Kernel**: æ‰€æœ‰Lossè®¡ç®—éƒ½åœ¨GPUä¸Šå®Œæˆ
- **Tile-basedæ¸²æŸ“**: gsplatä½¿ç”¨Tile-basedå…‰æ …åŒ–ï¼Œé«˜æ•ˆåˆ©ç”¨GPU

---

## åä¸€ã€ç¼–è¯‘å’Œè¿è¡Œ

### 11.1 ä¾èµ–
- CUDA 12.x
- LibTorch (PyTorch C++ API)
- OpenCV 4.x
- gsplat (git submodule)
- cnpy (ç”¨äº.npzæ–‡ä»¶)

### 11.2 ç¼–è¯‘æµç¨‹
```bash
cd cpp
mkdir build && cd build
cmake ..
make -j$(nproc)
```

### 11.3 è¿è¡Œ
```bash
./isogs_slam <dataset_path> <sequence>
```

---

## åäºŒã€åŠŸèƒ½å®Œæ•´æ€§æ€»ç»“

### 12.1 å·²å®Œæˆçš„æ ¸å¿ƒåŠŸèƒ½ï¼ˆâœ…ï¼‰

1. **SLAMæ ¸å¿ƒæµç¨‹**
   - âœ… SLAMä¸»å¾ªç¯æ¡†æ¶
   - âœ… Trackingæ¨¡å—ï¼ˆRGB/Depth/SSIM Lossï¼‰
   - âœ… Mappingæ¨¡å—ï¼ˆå®Œæ•´ä¼˜åŒ–æµç¨‹ï¼‰
   - âœ… ç¬¬ä¸€å¸§åˆå§‹åŒ–
   - âœ… Checkpointä¿å­˜/åŠ è½½

2. **å‡ ä½•çº¦æŸLoss**
   - âœ… Flat Lossï¼ˆå®Œæ•´å®ç°ï¼ŒCUDA Kernelï¼‰
   - âœ… Iso-Surface Lossï¼ˆå®Œæ•´å®ç°ï¼Œç©ºé—´å“ˆå¸ŒåŠ é€Ÿï¼‰

3. **æ¸²æŸ“ç³»ç»Ÿ**
   - âœ… RGBæ¸²æŸ“ï¼ˆgsplaté›†æˆï¼‰
   - âœ… Depthæ¸²æŸ“ï¼ˆgsplaté›†æˆï¼‰

4. **é«˜æ–¯æ¨¡å‹ç®¡ç†**
   - âœ… é¢„åˆ†é…å†…å­˜æ± 
   - âœ… Densificationï¼ˆåˆ†è£‚/å…‹éš†ï¼‰
   - âœ… Pruningï¼ˆè‡ªåŠ¨æ¸…ç†ï¼‰

5. **ä¼˜åŒ–å™¨**
   - âœ… CUDA Adamä¼˜åŒ–å™¨
   - âœ… å‚æ•°ç»„ç®¡ç†
   - âœ… æ¢¯åº¦æ¸…é›¶å’Œæ›´æ–°

6. **ç©ºé—´åŠ é€Ÿ**
   - âœ… ç©ºé—´å“ˆå¸Œè¡¨æ„å»º
   - âœ… KNNæŸ¥è¯¢
   - âœ… åŠå¾„æŸ¥è¯¢

7. **ç½‘æ ¼æå–**
   - âœ… Marching Cubesç®—æ³•
   - âœ… ç½‘æ ¼æå–å™¨
   - âœ… PLYæ–‡ä»¶ä¿å­˜

8. **æ•°æ®é›†æ”¯æŒ**
   - âœ… Replicaæ•°æ®é›†

9. **è¯„ä¼°å·¥å…·**
   - âœ… PSNRè®¡ç®—
   - âœ… SSIMè®¡ç®—
   - âœ… L1 Lossè®¡ç®—

### 12.2 å·²å®ç°ä½†éœ€å®Œå–„çš„åŠŸèƒ½ï¼ˆğŸŸ¡ï¼‰

1. **è¯„ä¼°å·¥å…·**
   - âœ… è½¨è¿¹è¯„ä¼°ï¼ˆATEï¼‰- å®Œæ•´å®ç°
   - ğŸŸ¡ æ–°è§†è§’åˆæˆè¯„ä¼° - æ¡†æ¶å®ç°ï¼ˆéœ€è¦å®Œå–„LPIPSå’Œå®Œæ•´æµç¨‹ï¼‰
   - ğŸŸ¡ ç½‘æ ¼å‡ ä½•è¯„ä¼° - æ ¸å¿ƒåŠŸèƒ½å®ç°ï¼ˆéœ€è¦PLYè§£æå™¨ï¼‰

2. **å¯è§†åŒ–å·¥å…·**
   - ğŸŸ¡ åœ¨çº¿å¯è§†åŒ– - æ¡†æ¶å®ç°ï¼ˆéœ€è¦OpenGL/OpenCVå®Œæ•´é›†æˆï¼‰
   - ğŸŸ¡ æœ€ç»ˆé‡å»ºå¯è§†åŒ– - æ¡†æ¶å®ç°ï¼ˆéœ€è¦OpenGL 3DæŸ¥çœ‹å™¨ï¼‰

3. **è¾…åŠ©è„šæœ¬**
   - âœ… å¯¼å‡ºPLYç‚¹äº‘ - å®Œæ•´å®ç°
   - ğŸŸ¡ ç¦»çº¿é«˜æ–¯æ³¼æº…è®­ç»ƒ - æ¡†æ¶å®ç°ï¼ˆéœ€è¦å®Œå–„è®­ç»ƒå¾ªç¯ï¼‰
   - ğŸŸ¡ SLAMåä¼˜åŒ– - æ¡†æ¶å®ç°ï¼ˆéœ€è¦å®Œå–„ä¼˜åŒ–æµç¨‹ï¼‰
   - âŒ iPhoneåœ¨çº¿æ¼”ç¤º - æœªå®ç°
   - âŒ æ•°æ®é›†è½¬æ¢å·¥å…· - æœªå®ç°

4. **æ•°æ®é›†æ”¯æŒ**
   - âœ… Replicaæ•°æ®é›† - å®Œæ•´å®ç°
   - ğŸŸ¡ TUMæ•°æ®é›† - æ¡†æ¶å®ç°ï¼ˆéœ€è¦å®Œå–„æ–‡ä»¶åŠ è½½é€»è¾‘ï¼‰
   - ğŸŸ¡ ScanNetæ•°æ®é›† - æ¡†æ¶å®ç°ï¼ˆéœ€è¦å®Œå–„æ–‡ä»¶åŠ è½½é€»è¾‘ï¼‰
   - ğŸŸ¡ ScanNet++æ•°æ®é›† - æ¡†æ¶å®ç°
   - ğŸŸ¡ ReplicaV2æ•°æ®é›† - æ¡†æ¶å®ç°
   - âœ… æ•°æ®é›†å·¥å‚æ¨¡å¼ - å®Œæ•´å®ç°
   - âŒ å…¶ä»–7ä¸ªæ•°æ®é›†ï¼ˆICLã€Azure Kinectç­‰ï¼‰- æœªå®ç°

### 12.3 å®Œå…¨ç¼ºå¤±çš„åŠŸèƒ½ï¼ˆğŸ”´ï¼‰

1. **iPhoneåœ¨çº¿æ¼”ç¤º**
   - âŒ ç½‘ç»œé€šä¿¡
   - âŒ å®æ—¶æ•°æ®å¤„ç†

2. **æ•°æ®é›†è½¬æ¢å·¥å…·**
   - âŒ NeRFCaptureåˆ°æ•°æ®é›†è½¬æ¢

3. **å…¶ä»–æ•°æ®é›†**
   - âŒ ICLã€Azure Kinectã€Record3Dã€RealSenseã€AI2Thorã€NeRFCaptureæ•°æ®é›†

---

**æ€»ç»“**: C++é‡æ„é¡¹ç›®åœ¨æ ¸å¿ƒSLAMåŠŸèƒ½ä¸Šå·²ç»éå¸¸å®Œæ•´ï¼ˆçº¦95-98%ï¼‰ï¼ŒåŒ…æ‹¬å®Œæ•´çš„Trackingã€Mappingã€Lossè®¡ç®—ã€ä¼˜åŒ–å™¨ã€Densificationã€Pruningã€ç½‘æ ¼æå–ç­‰ã€‚æ–°å¢åŠŸèƒ½åŒ…æ‹¬ï¼š
- âœ… å…³é”®å¸§é€‰æ‹©ç®—æ³•ï¼ˆå®Œæ•´å®ç°ï¼‰
- âœ… è½¨è¿¹è¯„ä¼°å·¥å…·ï¼ˆå®Œæ•´å®ç°ï¼‰
- âœ… å¯¼å‡ºPLYç‚¹äº‘å·¥å…·ï¼ˆå®Œæ•´å®ç°ï¼‰
- âœ… å·¥å…·å‡½æ•°è¡¥å……ï¼ˆå®Œæ•´å®ç°ï¼‰
- ğŸŸ¡ æ–°è§†è§’åˆæˆè¯„ä¼°ï¼ˆæ¡†æ¶å®ç°ï¼‰
- ğŸŸ¡ ç½‘æ ¼å‡ ä½•è¯„ä¼°ï¼ˆæ ¸å¿ƒåŠŸèƒ½å®ç°ï¼‰
- ğŸŸ¡ å¯è§†åŒ–å·¥å…·ï¼ˆæ¡†æ¶å®ç°ï¼‰
- ğŸŸ¡ ç¦»çº¿è®­ç»ƒå’Œåä¼˜åŒ–å·¥å…·ï¼ˆæ¡†æ¶å®ç°ï¼‰
- ğŸŸ¡ æ•°æ®é›†æ”¯æŒæ‰©å±•ï¼ˆTUMã€ScanNetç­‰æ¡†æ¶å®ç°ï¼‰

å¤§éƒ¨åˆ†åŠŸèƒ½æ¡†æ¶å·²å°±ç»ªï¼Œéƒ¨åˆ†éœ€è¦å®Œå–„å®ç°ç»†èŠ‚ï¼ˆæ•°æ®é›†æ–‡ä»¶åŠ è½½ã€å¯è§†åŒ–OpenGLé›†æˆã€LPIPSè®¡ç®—ç­‰ï¼‰ã€‚è¿™äº›åŠŸèƒ½æ¡†æ¶å·²å®ç°ï¼Œå¯ä»¥é€æ­¥å®Œå–„ç»†èŠ‚ã€‚
